{% extends 'layout.html.twig' %}

{% block title %}Liste des Guides{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        .chart-card {
            margin-bottom: 2rem;
            padding: 1rem;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
            padding: 20px;
        }
        
        .guide-container {
            padding: 2rem 0;
            background-color: #f8f9fa;
        }
        
        .guide-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            padding: 0;
            text-align: center;
            overflow: hidden;
            position: relative;
        }
        
        .guide-header {
            position: relative;
            padding-top: 100px;
            margin-bottom: 1.5rem;
            background: linear-gradient(45deg, #2193b0, #6dd5ed);
        }
        
        .guide-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: inherit;
            filter: blur(5px);
            transform: scale(1.1);
            z-index: 0;
        }
        
        .guide-image-container {
            position: relative;
            width: 150px;
            height: 150px;
            margin: -75px auto 20px;
            z-index: 2;
        }
        
        .guide-image {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 5px solid white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            overflow: hidden;
            position: relative;
        }
        
        .guide-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        
        .guide-image:hover img {
            transform: scale(1.1);
        }
        
        .guide-info {
            padding: 0 1.5rem 1.5rem;
        }
        
        .guide-name {
            font-size: 1.5rem;
            font-weight: 600;
            margin: 0 0 1rem;
            color: #333;
        }
        
        .guide-details {
            display: flex;
            align-items: center;
            margin-bottom: 0.75rem;
            color: #666;
            padding: 0 1rem;
        }
        
        .guide-details i {
            width: 24px;
            color: #2193b0;
            margin-right: 0.75rem;
        }
        
        .guide-actions {
            display: flex;
            gap: 0.75rem;
            margin-top: 1.5rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-top: 1px solid #eee;
        }
        
        .btn-action {
            flex: 1;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem;
            border: none;
            border-radius: 8px;
            color: white;
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .btn-action:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }
        
        .btn-action i {
            margin-right: 0.5rem;
        }
        
        .btn-view {
            background: linear-gradient(45deg, #2193b0, #6dd5ed);
        }
        
        .btn-edit {
            background: linear-gradient(45deg, #f7b733, #fc4a1a);
        }
        
        .btn-delete {
            background: #dc3545;
            position: relative;
            overflow: hidden;
        }
        
        .btn-delete::before {
            content: "Êtes-vous sûr ?";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #c82333;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }
        
        .btn-delete:hover::before {
            transform: translateX(0);
        }
        
        .btn-delete:hover {
            background: #c82333;
        }
        
        .social-links {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 1rem 0;
        }
        
        .social-link {
            color: #2193b0;
            font-size: 1.2rem;
            transition: color 0.2s ease;
        }
        
        .social-link:hover {
            color: #6dd5ed;
        }
    </style>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
{% endblock %}

{% block body %}
    <div class="content">
        <div class="container-fluid">
            <!-- Chart Card -->
            <div class="card chart-card">
                <div class="card-header">
                    <h3 class="card-title">Statistiques des Avis des Guides</h3>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="guideRatingsChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="page-header">
                <div class="container">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <h1 class="display-4">Nos Guides</h1>
                            <p class="lead">Découvrez nos guides professionnels</p>
                        </div>
                        <div class="col-md-6 text-md-end">
                            <a href="{{ path('app_guide_new1') }}" class="btn btn-primary">
                                <i class="fas fa-plus-circle"></i> Nouveau Guide
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="guide-container">
                <div class="container">
                    <div class="row">
                        {% for guide in guides %}
                            <div class="col-md-4">
                                <div class="guide-card">
                                    <div class="guide-header">
                                        <div class="guide-image-container">
                                            <div class="guide-image">
                                                {% if guide.photo %}
                                                    <img src="{{ asset('uploads/photos/' ~ guide.photo) }}" alt="{{ guide.nom }}">
                                                {% else %}
                                                    <img src="{{ asset('images/default-profile.jpg') }}" alt="Photo par défaut">
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="guide-info">
                                        <h3 class="guide-name">{{ guide.nom }} {{ guide.prenom }}</h3>
                                        
                                        <div class="guide-details">
                                            <i class="fas fa-envelope"></i>
                                            <span>{{ guide.email }}</span>
                                        </div>
                                        
                                        <div class="guide-details">
                                            <i class="fas fa-phone"></i>
                                            <span>{{ guide.numTelephone }}</span>
                                        </div>
                                        
                                        <div class="social-links">
                                            {% if guide.facebook %}
                                                <a href="{{ guide.facebook }}" class="social-link" target="_blank">
                                                    <i class="fab fa-facebook"></i>
                                                </a>
                                            {% endif %}
                                            {% if guide.instagram %}
                                                <a href="{{ guide.instagram }}" class="social-link" target="_blank">
                                                    <i class="fab fa-instagram"></i>
                                                </a>
                                            {% endif %}
                                        </div>
                                        
                                        <div class="guide-actions">
                                            <a href="{{ path('app_guide_show1', {'id': guide.id}) }}" class="btn-action btn-view">
                                                <i class="fas fa-eye"></i> Voir
                                            </a>
                                            <a href="{{ path('app_guide_edit1', {'id': guide.id}) }}" class="btn-action btn-edit">
                                                <i class="fas fa-edit"></i> Modifier
                                            </a>
                                            {{ include('guide/_delete_form.html.twig') }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% else %}
                            <div class="col-12">
                                <div class="alert alert-info text-center">
                                    Aucun guide trouvé. 
                                    <a href="{{ path('app_guide_new') }}" class="alert-link">Ajouter un guide</a>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Données des guides depuis Twig
            const guides = [
                {% for guide in guides %}
                    {
                        name: "{{ guide.nom }} {{ guide.prenom }}",
                        rating: {{ guide.nombreAvis|default(0) }}
                    }{% if not loop.last %},{% endif %}
                {% endfor %}
            ];
            
            console.log('Guides data:', guides); // Pour le débogage
            
            // Trier les guides par nombre d'avis (décroissant)
            guides.sort((a, b) => b.rating - a.rating);
            
            // Créer le graphique
            const ctx = document.getElementById('guideRatingsChart');
            if (ctx) {
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: guides.map(g => g.name),
                        datasets: [{
                            label: 'Nombre d\'avis',
                            data: guides.map(g => g.rating),
                            backgroundColor: guides.map(() => '#2193b0'),
                            borderColor: guides.map(() => '#6dd5ed'),
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 1,
                                    font: {
                                        size: 12
                                    }
                                }
                            },
                            x: {
                                ticks: {
                                    font: {
                                        size: 12
                                    }
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            },
                            title: {
                                display: true,
                                text: 'Classement des Guides par Nombre d\'Avis',
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                },
                                padding: {
                                    top: 10,
                                    bottom: 30
                                }
                            }
                        }
                    }
                });
            } else {
                console.error('Canvas element not found');
            }
        });
    </script>
{% endblock %}
