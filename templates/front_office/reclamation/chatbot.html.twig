{% extends 'base.html.twig' %}

{% block title %} Chatbot d'Aide {% endblock %}

{% block body %}
    <h2>Besoin d'aide ? Posez votre question au chatbot ðŸ¤–</h2>

    <div id="chatbox" style="width: 100%; max-width: 400px; height: 300px; border: 1px solid #ccc; overflow-y: scroll; padding: 10px;"></div>
    <input type="text" id="user-input" placeholder="Ã‰crivez un message..." style="width: 80%; padding: 5px;">
    <button onclick="sendMessage()">Envoyer</button>

    <script>
        function sendMessage() {
            let input = document.getElementById("user-input").value;
            let chatbox = document.getElementById("chatbox");

            if (input.trim() === "") return;

            chatbox.innerHTML += "<p><strong>Vous:</strong> " + input + "</p>";

            console.log("Envoi du message : " + input); // ðŸ”¥ Debug

            fetch("/chatbot/api", {
                method: "POST",
                body: JSON.stringify({message: input}),
                headers: {"Content-Type": "application/json"}
            })
            .then(response => response.json())
            .then(data => {
                console.log("RÃ©ponse du bot :", data.message); // ðŸ”¥ Debug
                chatbox.innerHTML += "<p><strong>Bot:</strong> " + data.message + "</p>";
            })
            .catch(error => {
                console.error("Erreur :", error);
                chatbox.innerHTML += "<p><strong>Bot:</strong> Une erreur est survenue.</p>";
            });

            document.getElementById("user-input").value = "";
        }
    </script>
{% endblock %}
